<!-- TODO: Editor -->
<link rel="import" href="../../../bower_components/juicy-ace-editor/juicy-ace-editor.html">
<link rel="import" href="device.html"/>

<dom-module id="pxm-code-editor">
  <style>
    :host {
      display: block;
			box-sizing: border-box;
		  margin: 0;
		  padding: 0;
    }
    :host .files-list{
      margin: 0;
      padding: 0;
      list-style-type: none;
      font-size: .8em;
    }
    :host .files-list li a{
      white-space: nowrap;
      color: #fff;
    }

    :host .selected{
      background-color: #eee;
    }

  </style>
  <template>

    <div class="container full-width">
      <div class="col-2" hidden="{{!files}}">
        <ul id="files" class="files-list padding-5 height-600 scroll-y">
          <template is="dom-repeat" items="{{files}}">
            <li class="item color-white">
              <a href=""
                on-click="selectTemplate"
                data-id="{{item.doc._id}}"
                data-rev="{{item.doc._rev}}">
                <pxm-icon icon="file-o" size=""></pxm-icon>
                <span>{{item.doc._id}}</span>
              </a>
            </li>
          </template>
        </ul>
      </div>
	    <div class="col-10">
        <div class="container full-width">
          <div class="col-6 overflow-hidden">
            <juicy-ace-editor id="_editor"
              theme="ace/theme/monokai"
              mode="ace/mode/html"
              fontsize="14px"
              softtabs="true"
             tabsize="2"
              class="position-relative height-600 full-height"></juicy-ace-editor>
          </div>
          <div id="outputWrap"
          class="col-6 background-color-white height-600 full-height overflow-auto">
            <content></content>
          </div>
        </div>
	    </div>
	  </div>


    <!--

        <pxm-example-device>

        </pxm-example-device>

      -->

  </template>
	<script type="text/javascript">
		Polymer({
		  is: "pxm-code-editor",
			properties: {
			  type: {
			    type: String,
					value: 'ios'
			  },
			  theme: {
			    type: String,
					value: 'monokai'
			  },
			  output: {
			    type: String,
					value: 'output'
			  },
			  device: {
			    type: String
			  },
			  mode: {
			    type: String,
					value: 'html'
			  },
				code: {
					type: String,
          observer: '_handleCodeChange'
				},

        files: {
          type: Array
        },
        selectedFile: {
          type: Object
        }
			},
			created: function(){
				console.warn(this.tagName, 'created');
			},
			attached: function(){
        var _this = this;
        var _editor = this.$._editor;
        _editor.$blockScrolling = Infinity;
				this.debounce('initEditor', function() {
          _editor.on('change', function(e) {
            _this.debounce('render', function(){
              console.log(e, e.target.value);

              if(_this.device){
                var d = _this.querySelector(_this.device);
                console.log('inject into', _this.device, d);
                d.setInput(e.target.value);
              //  _this.$.deviceOutput.html(e.target.value);
              } else {

                _this.$.outputWrap.html(e.target.value)
                _this.output = e.target.value;

              }
              _this.output = e.target.value;
            }, 800);
          });
        }, 500);
			},
      _clearSelected: function(){
        for (var i = 0; i < this.$.files.children.length; i++) {
          this.$.files.children[i].removeClass('selected');
        }
      },

      selectTemplate: function(e){
        e.preventDefault();
        this._clearSelected();
        e.target.parent().parent().toggleClass('selected');
        this.selectedFile = e.model.item;
        this.$._editor.value = this.selectedFile.doc.data;
      },
      _handleCodeChange: function(newVal, oldVal){
        console.warn('Code Changed', newVal);
        this.$._editor.value = newVal;

      }
		});
	</script>
</dom-module>
